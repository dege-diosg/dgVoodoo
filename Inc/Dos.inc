;-----------------------------------------------------------------------------
; DOS.INC - Some extract from dgVoodooConfig and DOS.H for the assembly
;
; Copyright (C) 2003 Dege
;
; This library is free software; you can redistribute it and/or
; modify it under the terms of the GNU Lesser General Public
; License as published by the Free Software Foundation; either
; version 2.1 of the License, or (at your option) any later version.
;
; This library is distributed in the hope that it will be useful,
; but WITHOUT ANY WARRANTY; without even the implied warranty of
; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
; Lesser General Public License for more details.
;
; You should have received a copy of the GNU Lesser General Public
; License along with this library; if not, write to the Free Software
; Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
;-----------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
; Definíciók, amelyek a Dos-os és Windows-os DLL-ben is kellenek
;------------------------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
;A wrapper konfigurációját leíró struktúra
dgVoodooConfig  STRUC

ProductVersion  DW	?
GlideVersion    DW	?
TexMemSize      DD      ?
Flags           DD      ?
Gamma           DD      ?
Version         DD      ?
VideoMemSize_c  DD      ?
VideoRefreshFreq DD     ?
dxres           DW      ?
dyres           DW      ?
dispdev         DW      ?
dispdriver      DW      ?
refreshRate		DD		?
flags2			DD		?
dosTimerBoostPeriod DW	?
alphaCKRefValue DB		?
language		DB		?
rendererApi		DB		?
reserved_c      DB      3 DUP(?)

dgVoodooConfig  ENDS

;------------------------------------------------------------------------------------------
; Alapértelmezett értékek a config struktúra mezôihez
MAXTEXNUM_D     EQU     2048            ;Textúrák max. száma
TEXTUREMEMSIZE  EQU     4*1024*1024     ;Voodoo-textúramem mérete

;------------------------------------------------------------------------------------------
; Konstansok a konfig struktúra flagjeihez
CFG_WBUFFER				EQU		1h			;W-buffert mindig Z-bufferen keresztül emulál
CFG_RELYONDRIVERFLAGS	EQU		CFG_WBUFFER
CFG_WINDOWED			EQU		2h			;Ablakos mód
CFG_DISPMODE32BIT		EQU		4h			;32 bites videomód
CFG_SETREFRESHRATE		EQU		8h			;A frissítési freq-t az alkalmazás
											;	állítja be (egyébként az akt. freq)
CFG_PERFECTTEXMEM		EQU		10h			;	Tökéletes textúramemória-emuláció
CFG_WBUFFERMETHODISFORCED EQU	80h			;	A W-bufferelés módszere kényszerített:
											;		- CFG_WBUFFER flag set: mindig valódi w-bufferelés
											;		- CFG_WBUFFER flag not set: mindig emulált w-bufferelés
											;						vagy a W-bufferelés módszere detektált, ekkor
											;		- CFG_RELYONDRIVERFLAGS set: a driver által a W-bufferelés támogatására
											;								 visszaadott flag alapján dönt
CFG_VESAENABLE          EQU     100h        ;Beépített VESA-támogatás engedélyezve
CFG_SETMOUSEFOCUS       EQU     200h        ;Egérfókusz az alkalmazásnál
CFG_SUPPORTMODE13H      EQU     400h        ;320x200x256 VGA-mód támogatása
CFG_TEXTURES32BIT       EQU     800h        ;mindig 32 bites textúrák
CFG_TEXTURES16BIT       EQU     1000h       ;mindig 16 bites textúrák
CFG_TEXTURERELOAD       EQU     2000h       ;Textúrák újratöltése, ha kell
CFG_GRABENABLE          EQU     4000h       ;Képernyõlopás engedélyezve
CFG_GRABCLIPBOARD       EQU     8000h       ;Képlopás a vágólapra
CFG_CKMGEFORCE          EQU     10000h      ;Colorkeying GeForce-ra (2-es módszer)
CFG_TOMBRAIDER          EQU     20000h      ;TR1 árnyékhiba-javítás
CFG_HUNGARIAN           EQU     40000h      ;A nyelv magyar
CFG_HWLFBCACHING        EQU     80000h      ;Hardveres gyorsítópufferek az LFB-hez
CFG_LFBREALVOODOO       EQU     100000h     ;Közelebb az igazi hardverhez
CFG_TRIPLEBUFFER        EQU     200000h     ;Mindig triplapufferelés
CFG_ACTIVEBACKGROUND    EQU     400000h     ;A háttéren is aktív a DOS-os prg
CFG_LFBFASTUNMATCHWRITE EQU     800000h     ;Gyorsírás a nem egyezõ LFB formátumokhoz
CFG_CTRLALT             EQU     1000000h    ;Egérfókusz elengedése Ctrl-Alt-ra
CFG_VSYNC               EQU     2000000h    ;Függõleges visszafutást mindig megvárni
CFG_NTVDDMODE           EQU     4000000h    ;a wrapper VDD-módban mûködik (XP-hez)
CFG_DISABLEMIPMAPPING   EQU     8000000h    ;Mipmapping tiltása
CFG_ENABLEGAMMARAMP     EQU     10000000h   ;Glide-gammaramp engedélyezése
CFG_ENABLEHWVBUFFER     EQU     20000000h   ;Hardveres vertex pufferek használata
CFG_BILINEARFILTER      EQU     40000000h   ;Mindig bilineáris szûrés a textúrákhoz
CFG_CLIPPINGBYD3D       EQU     80000000h   ;Vágás a Direct3D-n keresztül

CFG2_CLOSESTREFRESHFREQ EQU     1h
CFG_FORCECLIPOPF        EQU     2h          ;CLI/POPF megfelelõ kezelése - rejtett opció
CFG_LFBRESCALECHANGESONLY EQU   4h          ;eltérõ felbontások esetén csak a változások átméretezése,
                                            ; és nem az egész képé (gyorsírást igényel) - rejtett opció
CFG_LFBFORCEFASTWRITE   EQU   8h            ;Gyorsírás használata egyezõ formátumokhoz is - rejtett opció
CFG_YMIRROR             EQU   10h           ;Képernyõ függõleges tükrözése (origó-tesztekhez) - rejtett opció
CFG_FORCETRILINEARMIPMAPS EQU   20h         ;Trilineáris mipmapping kényszerítése - rejtett opció
CFG_PREFERTMUWIFPOSSIBLE  EQU   40h         ;táblás köd, z-buffer és TMUDIFFW hint esetén a tmu w-t
CFG_LFBALWAYSFLUSHWRITES  EQU	80h	    ;A régi lfb-unlock dude-módja: mindig kiírja a változásokat
					    ;(nem cache-el) (kompatibilitási és teszt-opció, rejtett)
CFG_DEPTHEQUALTOCOLOR	EQU	100h	    ;A képpuffer és a mélységi puffer bitmélysége legyen mindig egyenlõ								    ;(kompatibilitási és teszt-opció, rejtett)
CFG_DISABLELFBREAD	EQU	200h	    ;LFB elérésének tiltása olvasásra
CFG_DISABLELFBWRITE	EQU	400h	    ;LFB elérésének tiltása írásra
CFG_AUTOGENERATEMIPMAPS	EQU	800h	    ;A hiányzó mipmap-szintek automatikus generálása
CFG_LFBNOMATCHINGFORMATS  EQU	1000h	    ;Az LFB-formátumok mindig különbözõnek tekintendõk - rejtett opció
CFG_ALWAYSINDEXEDPRIMS	EQU	2000h		
CFG_HIDECONSOLE		EQU	4000h	    ;Konzol elrejtése (DOS)
CFG_LFBENABLETEXTURING	EQU	8000h
CFG_CFORMATAFFECTLFB	EQU	10000h
CFG_DISABLEVESAFLATLFB	EQU	20000h


;A konfig flagekben levõ bitmezõk értékei
CFG_CKMAUTOMATIC	EQU	00
CFG_CKMALPHABASED	EQU	01
CFG_CKMNATIVE		EQU	02
CFG_CKMNATIVETNT	EQU	03

;------------------------------------------------------------------------------------------
;Az egyes platformok kódjai
PLATFORM_WINDOWS          EQU   0
PLATFORM_DOSWIN9X         EQU   1
PLATFORM_DOSWINNT         EQU   2

;------------------------------------------------------------------------------------------
; Az aktuális videómód és annak pixelformátuma (VESA-hoz)

dgVoodooModeInfo        STRUC

modeIndex				DD		?
ModeNumber              DW      ?
XRes                    DW      ?
YRes                    DW      ?
BitPP                   DB      ?
RedSize                 DB      ?
RedPos                  DB      ?
GreenSize               DB      ?
GreenPos                DB      ?
BlueSize                DB      ?
BluePos                 DB      ?
RsvSize                 DB      ?
RsvPos                  DB      ?
                        DB      ?

dgVoodooModeInfo        ENDS

;------------------------------------------------------------------------------------------
; Egérkurzor-infó: jelenleg használaton kívûli */
MouseInfo       STRUC

mi_x            DD      ?
mi_y            DD      ?
brecttop_x      DD      ?
brecttop_y      DD      ?
brectbottom_x   DD      ?
brectbottom_y   DD      ?

MouseInfo       ENDS

;------------------------------------------------------------------------------------------

EXEBUFFSIZE     EQU     ((32*1024)/4)
FUNCDATASIZE    EQU     1536*1024

KFLAG_INKERNEL  	EQU     1h
KFLAG_VMWINDOWED	EQU	2h
KFLAG_SCREENSHOT        EQU     4h
KFLAG_GLIDEACTIVE       EQU     8h
KFLAG_SERVERWORKING	EQU	20h
KFLAG_CTRLALT		EQU	80h
KFLAG_PALETTECHANGED	EQU	100h
KFLAG_VESAFRESHDISABLED EQU	200h

AREAID_COMMAREA                 EQU     1
AREAID_REGSTRUCTURE_GLIDE211    EQU     2
AREAID_REGSTRUCTURE_GLIDE243    EQU     3

; A kommunikációs terület felépítése (ez van az osztott memóriaterületen)
CommArea        STRUC

areaId          DD      ?
kernelflag      DD      ?
ExeCodeIndex    DD      ?
FDPtr           DD      ?
progname        DB      128 DUP(?)
WinOldApHWND    DD      ?
VESAPalette     DD      256 DUP(?)
VESASession     DB      ?
VGAStateRegister3DA     DB      ?
VGARAMDACSize   DB      ?
                DB      ?
VideoMemory     DD      ?
videoMemoryClient DD	?
BytesPerScanLine DD     ?
DisplayOffset   DD      ?
actmodeinfo     dgVoodooModeInfo <>
vesaModeinfo    dgVoodooModeInfo <>
;mouseinfo       MouseInfo <>

ExeCodes        DD      EXEBUFFSIZE DUP(?)
FuncData        DB      FUNCDATASIZE DUP(?)

;LFB		DB	0 DUP(?)

CommArea        ENDS

;------------------------------------------------------------------------------------------
ServerRegInfo   STRUC

areaId_regs     DD      ?
workerthread_   DD      ?
commaptr        DD      ?
VideoMemSize    DD      ?
ConfigPtr       DD      ?
ErrorCode       DD      ?

ServerRegInfo   ENDS


;------------------------------------------------------------------------------------------
; Az egyes Glide-fûggvények kódjai

GRGLIDEINIT                     EQU             0
GRSSTWINOPEN                    EQU             1
GRSSTWINCLOSE                   EQU             2
GRGLIDESHUTDOWN                 EQU             3

GRBUFFERCLEAR                   EQU             4
GRBUFFERSWAP                    EQU             5

GUDRAWTRIANGLEWITHCLIP          EQU             6
GUAADRAWTRIANGLEWITHCLIP        EQU             7
GUDRAWPOLYGONVERTEXLISTWITHCLIP EQU             8
GRDRAWTRIANGLE                  EQU             9
GRDRAWPOLYGONVERTEXLIST         EQU             10
GRAADRAWPOLYGON                 EQU             11
GRAADRAWPOLYGONVERTEXLIST       EQU             12
GRAADRAWTRIANGLE                EQU             13
GRDRAWPLANARPOLYGON             EQU             14
GRDRAWPLANARPOLYGONVERTEXLIST   EQU             15
GRDRAWPOLYGON                   EQU             16
GRAADRAWLINE                    EQU             17
GRDRAWLINE                      EQU             18
GRAADRAWPOINT                   EQU             19
GRDRAWPOINT                     EQU             20


GRTEXDOWNLOADMIPMAP             EQU             21
GRTEXDOWNLOADMIPMAPLEVEL        EQU             22
GRTEXDOWNLOADMIPMAPLEVELPARTIAL EQU             23
GRTEXDOWNLOADTABLE              EQU             24
GRTEXDOWNLOADTABLEPARTIAL       EQU             25
GRTEXNCCTABLE                   EQU             26
GRTEXSOURCE                     EQU             27
GRTEXMIPMAPMODE                 EQU             28
GRTEXCOMBINE                    EQU             29
GRTEXFILTERMODE                 EQU             30
GRTEXCLAMPMODE                  EQU             31
GRTEXLODBIASVALUE               EQU             32
GRTEXMULTIBASE                  EQU             33
GRTEXMULTIBASEADDRESS           EQU             34

GUTEXALLOCATEMEMORY             EQU             35
GUTEXCHANGEATTRIBUTES           EQU             36
GUTEXCOMBINEFUNCTION            EQU             37
GUTEXDOWNLOADMIPMAP             EQU             38
GUTEXDOWNLOADMIPMAPLEVEL        EQU             39
GUTEXGETCURRENTMIPMAP           EQU             40
GUTEXGETMIPMAPINFO              EQU             41
GUTEXMEMQUERYAVAIL              EQU             42
GUTEXMEMRESET                   EQU             43
GUTEXSOURCE                     EQU             44
GU3DFGETINFO                    EQU             45
GU3DFLOAD                       EQU             46
GLIDEGETUTEXTURESIZE            EQU             47

GRCOLORCOMBINE                  EQU             48
GUCOLORCOMBINEFUNCTION          EQU             49
GRCONSTANTCOLORVALUE4           EQU             50
GRCOLORMASK                     EQU             51
GRCONSTANTCOLORVALUE            EQU             52
                                        
GRALPHABLENDFUNCTION            EQU             53
GRALPHACOMBINE                  EQU             54
GRALPHACONTROLSITRGBLIGHTING	EQU				55
GUALPHASOURCE                   EQU             56
GRALPHATESTFUNCTION             EQU             57
GRALPHATESTREFERENCEVALUE       EQU             58

GRFOGCOLORVALUE                 EQU             59
GRFOGMODE                       EQU             60
GRFOGTABLE                      EQU             61
GLIDEGETINDTOWTABLE             EQU             62
GUFOGTABLEINDEXTOW              EQU             63
GUFOGGENERATEEXP                EQU             64
GUFOGGENERATEEXP2               EQU             65
GUFOGGENERATELINEAR             EQU             66

GRRENDERBUFFER                  EQU             67
GRSSTORIGIN                     EQU             68
GRCLIPWINDOW                    EQU             69
GRCULLMODE                      EQU             70
GRDISABLEALLEFFECTS             EQU             71
GRDITHERMODE                    EQU             72
GRGAMMACORRECTIONVALUE          EQU             73
GRGLIDEGETSTATE                 EQU             74
GRGLIDESETSTATE                 EQU             75
GRHINTS                         EQU             76

GRSSTSCREENWIDTH                EQU             77
GRSSTSCREENHEIGHT               EQU             78
GRSSTSTATUS                     EQU             79
GRSSTVIDEOLINE                  EQU             80
GRSSTVRETRACEON                 EQU             81
GRSSTCONTROLMODE                EQU             82
GRBUFFERNUMPENDING              EQU             83
GRRESETTRISTATS                 EQU             84
GRTRISTATS                      EQU             85
                                        
GRDEPTHBUFFERMODE               EQU             86
GRDEPTHBUFFERFUNCTION           EQU             87
GRDEPTHMASK                     EQU             88
GRLFBCONSTANTALPHA              EQU             89
GRLFBREADREGION                 EQU             90
GRLFBWRITEREGION                EQU             91
GRDEPTHBIASLEVEL                EQU             92
GLIDEGETCONVBUFFXRES            EQU             93

GRCHROMAKEYMODE                 EQU             94
GRCHROMAKEYVALUE                EQU             95

GRLFBLOCK                       EQU             96
GRLFBUNLOCK                     EQU             97
GRLFBWRITECOLORFORMAT           EQU             98
GRLFBWRITECOLORSWIZZLE          EQU             99
GLIDESETUPLFBDOSBUFFERS         EQU             100

;Glide1-fggvnyek
GRSSTOPEN                       EQU             101
GRLFBBYPASSMODE                 EQU             102
GRLFBORIGIN                     EQU             103
GRLFBWRITEMODE                  EQU             104
GRLFBBEGIN                      EQU             105
GRLFBEND                        EQU             106
GRLFBGETREADPTR                 EQU             107
GRLFBGETWRITEPTR                EQU             108
GUFBREADREGION                  EQU             109
GUFBWRITEREGION                 EQU             110


;VESA-függvények
VESASETVBEMODE                  EQU             111
VESAUNSETVBEMODE                EQU             112
VESAFRESH                       EQU             113

;Ezeket a fûggvényeket a kernelmodul hivja
DGVOODOOCLIENTCRASHED           EQU             114
DGVOODOONEWCLIENTREGISTERING    EQU             115

;Egyéb függvények
DGVOODOOGETCONFIG               EQU             116
DGVOODOORELEASEFOCUS            EQU             117

GLIDEINSTALLMOUSE				EQU				118
GLIDEUNINSTALLMOUSE				EQU				119
GLIDEISMOUSEINSTALLED			EQU				120

VESAGETXRES						EQU				121
VESAGETYRES						EQU				122

PORTLOG_IN						EQU				123
PORTLOG_OUT						EQU				124

GLIDEENDITEM                    EQU             0FFFFFFFFh
